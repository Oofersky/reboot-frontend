<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–µ–∞–Ω—Å–∞</title>
    <style>
        :root {
            --text-white: #ffffff;
            --text-dark: #3c5a79;
            --glass-bg: rgba(255, 255, 255, 0.20);
            --glass-border: rgba(255, 255, 255, 0.5);
            --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            --emergency-red: #8b4b4b;
            --card-radius: 20px;
            --btn-green: #4b8b5a;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            outline: none;
        }

        body {
            background: linear-gradient(160deg, #9aabbd 0%, #8faecf 40%, #99b2cd 100%);
            min-height: 100vh;
            color: var(--text-white);
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .app-container {
            width: 100%;
            display: flex;
            flex-direction: column;
        }

        h1 {
            font-size: 28px;
            font-weight: 700;
            text-align: left;
            margin-top: 10px;
            margin-bottom: 20px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* --- –≠–∫—Ä–∞–Ω –º–æ–Ω–∏—Ç–æ—Ä–∞ --- */
        .monitor-panel {
            width: 100%;
            aspect-ratio: 16 / 9; 
            min-height: 300px; 
            background: #000000; 
            border: 1px solid var(--glass-border);
            border-radius: var(--card-radius);
            box-shadow: var(--glass-shadow);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #videoStream {
            width: 100%;
            height: 100%;
            object-fit: cover; 
            display: none;
            border-radius: var(--card-radius);
        }

        .stream-status {
            position: absolute;
            font-size: 16px;
            color: rgba(255, 255, 255, 0.8);
            z-index: 1;
            display: none;
            pointer-events: none;
            background: rgba(0,0,0,0.5);
            padding: 5px 10px;
            border-radius: 10px;
        }

        /* --- –ö–Ω–æ–ø–∫–∞ Play --- */
        .play-btn-overlay {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            backdrop-filter: blur(5px);
            transition: transform 0.2s, background 0.2s;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .play-btn-overlay:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(1.05);
        }

        .play-icon {
            width: 0; 
            height: 0; 
            border-top: 15px solid transparent;
            border-bottom: 15px solid transparent;
            border-left: 26px solid white;
            margin-left: 6px;
        }

        /* --- –ö–Ω–æ–ø–∫–∞ –†–µ–∫–æ–Ω–Ω–µ–∫—Ç–∞ --- */
        .reconnect-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 44px;
            height: 44px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: none; 
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 20;
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255,255,255,0.3);
            transition: background 0.2s, transform 0.2s;
        }

        .reconnect-btn:hover {
            background: rgba(255, 255, 255, 0.4);
        }
        
        .reconnect-btn:active {
            transform: rotate(180deg);
        }

        .reconnect-btn svg {
            width: 24px;
            height: 24px;
            stroke: white;
            stroke-width: 2;
            fill: none;
        }

        /* --- –û—Å—Ç–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã --- */
        .controls-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 450px;
            margin: 0 auto 25px auto;
            gap: 10px;
        }

        .glass-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            backdrop-filter: blur(8px);
            transition: transform 0.1s;
            flex-shrink: 0;
            color: white;
            text-decoration: none;
        }

        .glass-btn:active {
            transform: scale(0.95);
        }
        
        .glass-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .glass-btn svg {
            width: 28px;
            height: 28px;
            stroke: white;
            stroke-width: 2;
            fill: none;
        }

        .glass-btn span {
            font-weight: 700;
            font-size: 14px;
            color: white;
        }

        .emergency-btn {
            background: var(--emergency-red);
            color: white;
            border: none;
            padding: 14px 40px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin: 0 auto 30px auto;
            display: block;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            width: 80%;
            max-width: 300px;
        }

        .subtitle-label {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 10px;
            text-align: left;
            padding-left: 5px;
        }

        .subtitle-input-container {
            width: 100%;
            flex-grow: 1;
            min-height: 100px;
            background: rgba(60, 90, 121, 0.35); 
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .subtitle-input {
            width: 100%;
            height: 100%;
            background: transparent;
            border: none;
            color: white;
            font-size: 14px;
            resize: none;
        }

        .subtitle-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        /* --- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø IP --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            z-index: 1000;
            display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-box {
            background: rgba(60, 80, 100, 0.85);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .modal-title {
            font-size: 20px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .modal-desc {
            font-size: 14px;
            margin-bottom: 20px;
            color: rgba(255,255,255,0.8);
        }

        .ip-input {
            width: 100%;
            padding: 12px 15px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .ip-input:focus {
            background: rgba(255,255,255,0.2);
            border-color: white;
        }

        .modal-btn {
            background: var(--btn-green);
            color: white;
            border: none;
            padding: 10px 30px;
            border-radius: 20px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.1s;
            width: 100%;
        }

        .modal-btn:active {
            transform: scale(0.98);
        }

        /* --- –°—Ç–∏–ª–∏ –¥–ª—è –º–µ—Ö–∞–Ω–∏–∫–∏ –ø–∞—É–∑—ã –∏ —Å–æ–æ–±—â–µ–Ω–∏–π --- */
        .chat-controls {
            width: 100%;
            margin-bottom: 25px;
        }

        .pause-btn {
            width: 100%;
            padding: 18px 35px;
            font-size: 20px;
            background: rgba(52, 152, 219, 0.8);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
            transition: all 0.2s ease;
            font-weight: 500;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .pause-btn:hover {
            background: rgba(41, 128, 185, 0.9);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
        }
        
        .pause-btn:active {
            transform: scale(0.98);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—É–±—Ç–∏—Ç—Ä–æ–≤ —Å –∫–Ω–æ–ø–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ */
        .subtitle-section {
            width: 100%;
            margin-bottom: 20px;
        }

        .subtitle-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .subtitle-label {
            font-size: 18px;
            font-weight: 700;
            text-align: left;
            padding-left: 5px;
            margin: 0;
        }

        .send-subtitle-btn {
            padding: 10px 20px;
            background: rgba(44, 130, 201, 0.8);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s ease;
            font-weight: 500;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 6px;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            white-space: nowrap;
        }
        
        .send-subtitle-btn:hover {
            background: rgba(37, 115, 167, 0.9);
        }

        .subtitle-input-with-btn {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .subtitle-input-container {
            width: 100%;
            min-height: 100px;
            background: rgba(60, 90, 121, 0.35); 
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 0;
        }
    </style>
</head>
<body>

    <div class="app-container">
        
        <h1>–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–µ–∞–Ω—Å–∞</h1>

        <!-- –ú–æ–Ω–∏—Ç–æ—Ä -->
        <div class="monitor-panel">
            
            <!-- –ö–Ω–æ–ø–∫–∞ –†–µ–∫–æ–Ω–Ω–µ–∫—Ç–∞ -->
            <div class="reconnect-btn" id="reconnectBtn" onclick="tryReconnect()" title="–û–±–Ω–æ–≤–∏—Ç—å –≤–∏–¥–µ–æ">
                <svg viewBox="0 0 24 24">
                    <path d="M23 4v6h-6"></path>
                    <path d="M1 20v-6h6"></path>
                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                </svg>
            </div>

            <div id="statusText" class="stream-status">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</div>
            
            <div class="play-btn-overlay" id="startBtn" onclick="startStream()">
                <div class="play-icon"></div>
            </div>

            <img id="videoStream" src="" alt="Stream">
        </div>

        <!-- –ú–µ—Ö–∞–Ω–∏–∫–∞ –ø–∞—É–∑—ã -->
        <div class="chat-controls">
            <button class="pause-btn" onclick="sendToGodot()">
                <span id="pauseIcon">‚è∏Ô∏è</span>
                <span id="pauseText">–ü–∞—É–∑–∞</span>
            </button>
        </div>

        <div class="controls-row">
            <button class="glass-btn">
                <svg viewBox="0 0 24 24"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
            </button>
            <button class="glass-btn">
                <svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
            </button>
            
            <!-- –ö–Ω–æ–ø–∫–∞ EMDR —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π -->
            <button class="glass-btn" onclick="startEmdr()">
                <span>EMDR</span>
            </button>
        </div>

        <button class="emergency-btn" onclick="stopStreamAndAlert()">
            –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π –≤—ã—Ö–æ–¥
        </button>

        <!-- –°—É–±—Ç–∏—Ç—Ä—ã —Å –∫–Ω–æ–ø–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
        <div class="subtitle-section">
            <div class="subtitle-header">
                <div class="subtitle-label">–°—É–±—Ç–∏—Ç—Ä—ã</div>
                <button class="send-subtitle-btn" onclick="sendSubtitleMessage()">
                    <span>üì®</span>
                    <span>–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—É–±—Ç–∏—Ç—Ä—ã</span>
                </button>
            </div>
            <div class="subtitle-input-with-btn">
                <div class="subtitle-input-container">
                    <textarea class="subtitle-input" id="subtitleInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–∞..."></textarea>
                </div>
            </div>
        </div>

    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤–≤–æ–¥–∞ IP -->
    <div id="ipModal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-title">–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</div>
            <div class="modal-desc">–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É –∞–¥—Ä–µ—Å—É localhost:8081.<br>–í–≤–µ–¥–∏—Ç–µ IP –∞–¥—Ä–µ—Å –∏ –ø–æ—Ä—Ç –≤–∏–¥–µ–æ-–ø–æ—Ç–æ–∫–∞:</div>
            
            <input type="text" id="customIpInput" class="ip-input" placeholder="192.168.0.100:81" value="192.168.">
            
            <button class="modal-btn" onclick="saveAndConnect()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
        </div>
    </div>

    <script>
        const videoStream = document.getElementById('videoStream');
        const startBtn = document.getElementById('startBtn');
        const reconnectBtn = document.getElementById('reconnectBtn');
        const statusText = document.getElementById('statusText');
        const subtitleInput = document.getElementById('subtitleInput');
        
        const ipModal = document.getElementById('ipModal');
        const customIpInput = document.getElementById('customIpInput');

        // –ò—Å—Ö–æ–¥–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        const DEFAULT_STREAM_URL = 'http://localhost:8081';
        const DEFAULT_CONTROL_URL = 'http://localhost:9080';
        
        // –¢–µ–∫—É—â–∏–µ —Ä–∞–±–æ—á–∏–µ –∞–¥—Ä–µ—Å–∞
        let currentStreamUrl = DEFAULT_STREAM_URL;
        let currentControlUrl = DEFAULT_CONTROL_URL;
        
        let isStreaming = false;
        let isFirstAttempt = true;
        let isPaused = false;
        
        // --- –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø (TCP) ---

        function sendToGodot() {
            const btn = document.querySelector('.pause-btn');
            const icon = document.getElementById('pauseIcon');
            const text = document.getElementById('pauseText');
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –Ω–∞–∂–∞—Ç–∏—è
            btn.style.transform = 'scale(0.98)';
            setTimeout(() => { btn.style.transform = ''; }, 150);
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π URL)
            fetch(`${currentControlUrl}/button_pressed`)
                .then(response => {
                    isPaused = !isPaused;
                    if (isPaused) {
                        icon.textContent = '‚ñ∂Ô∏è';
                        text.textContent = '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å';
                    } else {
                        icon.textContent = '‚è∏Ô∏è';
                        text.textContent = '–ü–∞—É–∑–∞';
                    }
                    console.log("–°—Ç–∞—Ç—É—Å –ø–∞—É–∑—ã –∏–∑–º–µ–Ω–µ–Ω");
                })
                .catch(err => {
                    console.error("–û—à–∏–±–∫–∞ –ø–∞—É–∑—ã:", err);
                    btn.style.background = '#e74c3c';
                    setTimeout(() => {
                        btn.style.background = isPaused ? 'rgba(41, 128, 185, 0.9)' : 'rgba(52, 152, 219, 0.8)';
                    }, 1000);
                });
        }

        // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø –î–õ–Ø EMDR
        function startEmdr() {
            const btn = event.currentTarget; // –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∂–∞—Ç—É—é –∫–Ω–æ–ø–∫—É
            
            // –ê–Ω–∏–º–∞—Ü–∏—è
            btn.style.transform = 'scale(0.9)';
            setTimeout(() => { btn.style.transform = ''; }, 150);
            
            console.log("–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã EMDR...");
            
            fetch(`${currentControlUrl}/emdr_start`)
                .then(response => {
                    console.log("EMDR –º–µ–Ω—é –æ—Ç–∫—Ä—ã—Ç–æ –≤ –∏–≥—Ä–µ");
                    // –í–∏–∑—É–∞–ª—å–Ω—ã–π –æ—Ç–∫–ª–∏–∫ - –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –º–µ–Ω—è–µ–º —Ü–≤–µ—Ç
                    const originalBg = btn.style.background;
                    btn.style.background = 'rgba(75, 139, 90, 0.5)'; // –ó–µ–ª–µ–Ω–æ–≤–∞—Ç—ã–π
                    setTimeout(() => { btn.style.background = originalBg; }, 500);
                })
                .catch(err => {
                    console.error("–û—à–∏–±–∫–∞ EMDR:", err);
                    btn.style.background = 'rgba(139, 75, 75, 0.5)'; // –ö—Ä–∞—Å–Ω–æ–≤–∞—Ç—ã–π –ø—Ä–∏ –æ—à–∏–±–∫–µ
                    setTimeout(() => { btn.style.background = ''; }, 1000);
                });
        }

        function sendSubtitleMessage() {
            const message = subtitleInput.value.trim();
            
            if(message) {
                fetch(`${currentControlUrl}/chat_message`, {
                    method: "POST",
                    body: message
                })
                .then(response => {
                    console.log("–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ:", message);
                    const sendBtn = document.querySelector('.send-subtitle-btn');
                    const originalText = sendBtn.innerHTML;
                    sendBtn.innerHTML = '<span>‚úì</span><span>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</span>';
                    sendBtn.style.background = 'rgba(39, 174, 96, 0.8)';
                    
                    setTimeout(() => {
                        sendBtn.innerHTML = originalText;
                        sendBtn.style.background = 'rgba(44, 130, 201, 0.8)';
                    }, 1500);
                })
                .catch(err => {
                    console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —á–∞—Ç–∞:", err);
                });
            }
        }

        subtitleInput.addEventListener('keydown', function(e) {
            if(e.ctrlKey && e.key === 'Enter') {
                sendSubtitleMessage();
            }
        });

        // --- –§–£–ù–ö–¶–ò–ò –í–ò–î–ï–û –ò –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø ---

        function startStream() {
            if (isStreaming) return;
            startBtn.style.display = 'none';
            statusText.style.display = 'block';
            statusText.textContent = '–ü–æ–∏—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞...';
            attemptConnection(currentStreamUrl);
        }

        function attemptConnection(url) {
            videoStream.src = '';
            const timeStampedUrl = url + (url.includes('?') ? '&' : '?') + 't=' + new Date().getTime();

            videoStream.onload = function() {
                console.log("Connected to " + url);
                statusText.style.display = 'none';
                videoStream.style.display = 'block';
                reconnectBtn.style.display = 'flex';
                isStreaming = true;
                isFirstAttempt = false;
            };

            videoStream.onerror = function() {
                console.log("Error connecting to " + url);
                if (isFirstAttempt) {
                    statusText.textContent = '–°–µ—Ä–≤–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω';
                    videoStream.style.display = 'none';
                    openIpModal();
                } else {
                    statusText.textContent = '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è';
                    statusText.style.display = 'block';
                    videoStream.style.display = 'none';
                }
            };
            videoStream.src = timeStampedUrl;
        }

        function openIpModal() {
            ipModal.style.display = 'flex';
            customIpInput.focus();
        }

        function saveAndConnect() {
            let inputVal = customIpInput.value.trim();
            
            if (!inputVal) {
                alert("–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å!");
                return;
            }

            if (!inputVal.startsWith('http://') && !inputVal.startsWith('https://')) {
                inputVal = 'http://' + inputVal;
            }

            // 1. –û–±–Ω–æ–≤–ª—è–µ–º –∞–¥—Ä–µ—Å –≤–∏–¥–µ–æ-–ø–æ—Ç–æ–∫–∞ (–ø–æ—Ä—Ç –æ–±—ã—á–Ω–æ 8081)
            currentStreamUrl = inputVal;
            
            // 2. –û–±–Ω–æ–≤–ª—è–µ–º –∞–¥—Ä–µ—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ø–æ—Ä—Ç 9080)
            // –ú—ã –±–µ—Ä–µ–º —Ç—É –∂–µ —á–∞—Å—Ç—å IP, –Ω–æ –º–µ–Ω—è–µ–º –ø–æ—Ä—Ç
            try {
                const urlObj = new URL(inputVal);
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ —Ö–æ—Å—Ç–Ω–µ–π–º (IP), –Ω–æ –∂–µ—Å—Ç–∫–æ —Å—Ç–∞–≤–∏–º –ø–æ—Ä—Ç 9080 –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                currentControlUrl = `${urlObj.protocol}//${urlObj.hostname}:9080`;
                console.log("Control URL updated to:", currentControlUrl);
            } catch (e) {
                console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å URL –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Ñ–æ–ª—Ç");
            }

            ipModal.style.display = 'none';
            statusText.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ' + inputVal + '...';
            statusText.style.display = 'block';
            
            attemptConnection(currentStreamUrl);
        }

        function tryReconnect() {
            reconnectBtn.style.transform = 'rotate(180deg)';
            setTimeout(() => reconnectBtn.style.transform = 'rotate(0deg)', 300);
            statusText.textContent = '–†–µ–∫–æ–Ω–Ω–µ–∫—Ç...';
            statusText.style.display = 'block';
            videoStream.style.display = 'none';
            attemptConnection(currentStreamUrl);
        }

        function stopStreamAndAlert() {
            videoStream.src = '';
            videoStream.style.display = 'none';
            reconnectBtn.style.display = 'none';
            startBtn.style.display = 'flex';
            statusText.style.display = 'none';
            isStreaming = false;
            isFirstAttempt = true;
            alert('–≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π –≤—ã—Ö–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
        }
        
        customIpInput.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                saveAndConnect();
            }
        });
    </script>

</body>
</html>